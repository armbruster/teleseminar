<!DOCTYPE html>

<html>
<head>
	<title>First webgl/three.js test</title>
	<script type="text/javascript" src="js/Three.js"></script>
	<script type="text/javascript" src="js/RequestAnimationFrame.js"></script>
	 <script src="js/Detector.js"></script>
	 <script src="js/jquery.min.js"></script>
	<script type="text/javascript">
	window.onload = function () {

		var camera, scene, renderer,
		geometry, mesh, importMesh;
		
		var meshDesk = new Array();	
		var adac_reverse,  adac_nrAdded;

		// floor
		var plane, planeMaterial;

		// keyboard movement
		var up = false;
			sx = false,
      		dx = false,
      		dw = false,
      		sp = false;

		init();
		animate();


		function init() {
			adac_reverse = 1;
			adac_nrAdded = 0;
		
			scene = new THREE.Scene();

			camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 10000 );
			camera.position.z = 800;
			camera.position.y = 200;
			camera.rotation.x = 50;
			scene.add( camera );
	
			
			var material = new THREE.MeshLambertMaterial( { color: 0xFF0000 } );

			//addDeskAndChair(scene, 2);
			addRoomEnvironment(scene);
			
			// Just a reference cube to see how large the imported models are.
			var ref_cube = new THREE.Mesh(
								new THREE.CubeGeometry( 50, 50, 50 ),
								new THREE.MeshLambertMaterial( { color: 0xFF0000 } )
							);
			scene.add( ref_cube );

			// floor
			planeMaterial = new THREE.MeshLambertMaterial({ 
			map: THREE.ImageUtils.loadTexture("textures/floor-512.jpg")
			});
        	plane = new THREE.Mesh( new THREE.PlaneGeometry( 1500, 1500, 4, 4 ), planeMaterial );
 	       	plane.rotation.x = - 90 * ( Math.PI / 180 );
    	   	plane.position.y = -250;
       		plane.position.z = 0;
	        plane.overdraw = true;	
     	   	scene.add( plane );

     	   	document.addEventListener("keydown", onKeyDown, false);
        	document.addEventListener("keyup", onKeyUp, false);


			renderer = new THREE.WebGLRenderer(  );
      		renderer.setSize( window.innerWidth,window.innerHeight );
      		document.body.appendChild( renderer.domElement );
			
			// create a point light
			var pointLight = new THREE.PointLight(0xFFFFFF);
			pointLight.position.set(-100, 20, 500);		
			scene.add(pointLight);
	               // document.getElementById('debug').innerHTML = "TEST";
			document.body.appendChild( renderer.domElement );

		}
	
		
		function animate() {
			requestAnimationFrame( animate );
			render();
		}

		function onKeyDown(a) { //pressing buttion
		       var b = a.keyCode;
		       if (b == 38 || b == 87) up = true;  //w
		       else if (b == 40 || b == 83) dw = true; //s
		       else if (b == 37 || b == 65) sx = true; //a
		       else if (b == 39 || b == 68) dx = true; //d
		  }
		     
		  function onKeyUp(a) { // letting go button
		       a = a.keyCode;
		       if (a == 38 || a == 87) up = false;
		       else if (a == 40 || a == 83) dw = false;
		       else if (a == 37 || a == 65) sx = false;
		       else if (a == 39 || a == 68) dx = false;
		       else if (a == 32) sp = false;
		  }

		function render() {
			
		    if (up && dx) {
		      camera.position.x += 10;
		      camera.position.z -= 10;
		    }
		    else if (dx){
		      camera.position.x += 20;
		    }
		    else if (sx) {
		      camera.position.x -= 20;
		    }
		    else if (up) {
		      camera.position.z -= 20;
		    }
		    else if (dw) {
		      camera.position.z += 20;
		    }

		    renderer.render( scene, camera );
		}
	};
	</script>

	<script type="text/javascript" src="js/addRoom.js"></script>
	</head>
	<body>
		<div id="debug">
		</div>
	</body>
</html>
